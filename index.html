// --- DENTRO DE TU GENERADOR ---
document.getElementById('access-form').onsubmit = (e) => {
    e.preventDefault();
    const exp = document.getElementById('fecha-exp').value;
    
    // Simplificamos nombres de variables para acortar el QR
    const data = {
        g: document.getElementById('grado').value,
        n: document.getElementById('nombre').value,
        i: document.getElementById('id').value, // 'i' en lugar de 'id'
        d: document.getElementById('dependencia').value,
        t: document.getElementById('tipo-v').value,
        c: document.getElementById('color-v').value,
        p: document.getElementById('placa').value,
        e: exp ? new Date(exp + 'T23:59:59').getTime() : 0,
        a: adminName, // 'a' de admin
        f: new Date().toLocaleDateString()
    };

    const strData = JSON.stringify(data);
    const encrypted = CryptoJS.AES.encrypt(strData, SECRET_KEY).toString();

    // GENERAR QR (Asegúrate de que el size sea grande)
    const qr = new QRious({
        element: document.getElementById('qr-canvas'),
        value: encrypted,
        size: 400,
        level: 'L' // Calidad L es mejor para textos largos
    });
    
    // Muestra en consola lo que se está guardando (para tu control)
    console.log("Datos encriptados:", encrypted);

    document.getElementById('download-btn').style.display = "block";
    document.getElementById('download-btn').href = document.getElementById('qr-canvas').toDataURL();
};
